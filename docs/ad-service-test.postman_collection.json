{
	"info": {
		"_postman_id": "64887f9b-000a-4090-81ee-c80a37538ed0",
		"name": "ad-service-test",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Create and check Ad",
			"item": [
				{
					"name": "Create new ad",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"ТЕСТ ДОБАВЛЕНИЯ\",\n    \"price\": 123123,\n    \"description\": \"Добавляем - проверяем\",\n    \"main_photo\": \"https://picsum.photos/id/123/200/200\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "localhost:8000/ads/",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								""
							]
						}
					},
					"response": []
				},
				{
					"name": "Get ad: id=9 all fields",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/9?fields=description&fields=photos&fields=tags",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"9"
							],
							"query": [
								{
									"key": "fields",
									"value": "description"
								},
								{
									"key": "fields",
									"value": "photos"
								},
								{
									"key": "fields",
									"value": "tags"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete ad: id=9",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/9",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"9"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create new ad with fields",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"ТЕСТ ДОБАВЛЕНИЯ\",\n    \"price\": 123123,\n    \"description\": \"Добавляем - проверяем\",\n    \"main_photo\": \"https://picsum.photos/id/121/200/200\",\n    \"other_photos\": [\n        \"https://picsum.photos/id/122/200/200\",\n        \"https://picsum.photos/id/123/200/200\"\n    ],\n    \"tags\": [\n        \"Тэг 1\",\n        \"ЗЕЛЕНЫЙ\",\n        \"Тэг 2\",\n        \"ВАЖНОЕ\"\n    ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "localhost:8000/ads/",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								""
							]
						}
					},
					"response": []
				},
				{
					"name": "Get ad tags",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/9/tags",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"9",
								"tags"
							]
						}
					},
					"response": []
				},
				{
					"name": "List tags",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/tags/",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"tags",
								""
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Get Ad",
			"item": [
				{
					"name": "Get ad: id=8",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/8",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"8"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get ad tags: id=8",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/8/tags",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"8",
								"tags"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get ad photos: id=8",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/8/photos",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"8",
								"photos"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get ad: id=8 all fields",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/8?fields=description&fields=photos&fields=tags",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"8"
							],
							"query": [
								{
									"key": "fields",
									"value": "description"
								},
								{
									"key": "fields",
									"value": "photos"
								},
								{
									"key": "fields",
									"value": "tags"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get ad: id=8 fields=description",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/8?fields=description",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"8"
							],
							"query": [
								{
									"key": "fields",
									"value": "description"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get ad: id=8 fields=photos",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/8?fields=photos",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"8"
							],
							"query": [
								{
									"key": "fields",
									"value": "photos"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get ad: id=8 fields=tags",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/8?fields=tags",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"8"
							],
							"query": [
								{
									"key": "fields",
									"value": "tags"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get ad: id=8 with error fields (fields=kek)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/8?fields=kek&fields=description&fields=photos",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"8"
							],
							"query": [
								{
									"key": "fields",
									"value": "kek"
								},
								{
									"key": "fields",
									"value": "description"
								},
								{
									"key": "fields",
									"value": "photos"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "List Ads",
			"item": [
				{
					"name": "List ads",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								""
							]
						}
					},
					"response": []
				},
				{
					"name": "List ads with error sorting (sortby=kek)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/?sortby=name&sortby=price&sortby=kek&sortby=description&order=dsc&order=dsc&order=asc&order=dsc",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								""
							],
							"query": [
								{
									"key": "sortby",
									"value": "name"
								},
								{
									"key": "sortby",
									"value": "price"
								},
								{
									"key": "sortby",
									"value": "kek"
								},
								{
									"key": "sortby",
									"value": "description"
								},
								{
									"key": "order",
									"value": "dsc"
								},
								{
									"key": "order",
									"value": "dsc"
								},
								{
									"key": "order",
									"value": "asc"
								},
								{
									"key": "order",
									"value": "dsc"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "List ads sortby=name order=dsc",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/?sortby=name&order=dsc",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								""
							],
							"query": [
								{
									"key": "sortby",
									"value": "name"
								},
								{
									"key": "order",
									"value": "dsc"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Delete Ad",
			"item": [
				{
					"name": "Delete ad: id=1",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/1",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"1"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete ad: id=2",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/2",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"2"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete ad: id=3",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/3",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"3"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete ad: id=4",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/4",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"4"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete ad: id=5",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/5",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"5"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete ad: id=6",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/6",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"6"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete ad: id=7",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/7",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"7"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete ad: id=8",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/8",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"8"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "List Tags",
			"item": [
				{
					"name": "List tags",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/tags/",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"tags",
								""
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "error sorting (sortby=kek)",
			"item": [
				{
					"name": "Search ads by all available columns",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "localhost:8000/ads/search?username=test&startdate=2021-10-12&enddate=2021-10-15&tags=ТЕСТ&tags=КРАСНЫЙ",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"ads",
								"search"
							],
							"query": [
								{
									"key": "username",
									"value": "test"
								},
								{
									"key": "startdate",
									"value": "2021-10-12"
								},
								{
									"key": "enddate",
									"value": "2021-10-15"
								},
								{
									"key": "tags",
									"value": "ТЕСТ"
								},
								{
									"key": "tags",
									"value": "КРАСНЫЙ"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Auth",
			"item": [
				{
					"name": "Auth signin user=test",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"test\",\n    \"password\": \"test\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "localhost:8000/auth/signin",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"auth",
								"signin"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create new user",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Новый пользователь\",\n    \"username\": \"user\",\n    \"password\": \"user\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "localhost:8000/auth/signup",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"auth",
								"signup"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{currentAccessToken}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"const echoPostRequest = {",
					"  url: 'localhost:8000/auth/signin',",
					"  method: 'POST',",
					"  header: 'Content-Type:application/json',",
					"  body: {",
					"    mode: 'application/json',",
					"    raw: JSON.stringify(",
					"        {",
					"            \"username\": \"test\",",
					"            \"password\": \"test\"",
					"        })",
					"  }",
					"};",
					"",
					"var getToken = true;",
					"",
					"if (!pm.environment.get('accessTokenExpiry') || ",
					"    !pm.environment.get('currentAccessToken')) {",
					"    console.log('Token or expiry date are missing')",
					"} else if (pm.environment.get('accessTokenExpiry') <= (new Date()).getTime()) {",
					"    console.log('Token is expired')",
					"} else {",
					"    getToken = false;",
					"    console.log('Token and expiry date are all good');",
					"}",
					"",
					"if (getToken === true) {",
					"    pm.sendRequest(echoPostRequest, function (err, res) {",
					"    console.log(err ? err : res.json());",
					"        if (err === null) {",
					"            console.log('Saving the token and expiry date')",
					"            var responseJson = res.json();",
					"            pm.environment.set('currentAccessToken', responseJson.token)",
					"    ",
					"            var expiryDate = new Date();",
					"            // expiryDate.setSeconds(expiryDate.getSeconds() + responseJson.expires_at);",
					"            expiryDate.setSeconds(responseJson.expires_at);",
					"            pm.environment.set('accessTokenExpiry', expiryDate.getTime());",
					"        }",
					"    });",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	]
}